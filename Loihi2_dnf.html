

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DNF Loihi 2 &mdash; NeuroCam TAU 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ROS interface" href="ros_interface.html" />
    <link rel="prev" title="Intel Neuromorphic Chip" href="Loihi2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NeuroCam TAU
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Camera Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Azure_Kinect.html">Azure Kinect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prophesee_EVK4.html">Prophesee EVK4</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html">Calibration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Neuromorphic Computing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Loihi2.html">Intel Neuromorphic Chip</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DNF Loihi 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#simulation-of-multiple-dnfs">Simulation of multiple DNFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-memory">Working memory</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Camera / Loihi Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ros_interface.html">ROS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="kinect_interface.html">Kinect Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="prophesee_interface.html">EVK4 interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="evk4_loihi2.html">EVK4 Loihi 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="ros_loihi2.html">ROS Loihi 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="kinect_loihi2.html">Kinect Loihi 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensor_fusion.html">Sensor Fusion</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NeuroCam TAU</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DNF Loihi 2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Loihi2_dnf.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dnf-loihi-2">
<h1>DNF Loihi 2<a class="headerlink" href="#dnf-loihi-2" title="Link to this heading"></a></h1>
<p>We introduce here the simulation of dynamic neural fields as spiking neural networks</p>
<section id="simulation-of-multiple-dnfs">
<h2>Simulation of multiple DNFs<a class="headerlink" href="#simulation-of-multiple-dnfs" title="Link to this heading"></a></h2>
<p>In this example, we are simulating 2 one dimensional neural fields that project their activation into a 2D Field. Here is the code below :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span>
<span class="kn">from</span> <span class="nn">lava.proc.lif.process</span> <span class="kn">import</span> <span class="n">LIF</span> <span class="c1"># type: ignore</span>
<span class="kn">from</span> <span class="nn">lava.proc.monitor.process</span> <span class="kn">import</span> <span class="n">Monitor</span>
<span class="kn">from</span> <span class="nn">lava.proc.monitor.models</span> <span class="kn">import</span> <span class="n">PyMonitorModel</span>
<span class="kn">from</span> <span class="nn">lava.proc.dense.process</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.sink</span> <span class="kn">import</span> <span class="n">RingBuffer</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.extractor</span> <span class="kn">import</span> <span class="n">VarWire</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.utils</span> <span class="kn">import</span> <span class="n">ChannelConfig</span><span class="p">,</span> <span class="n">SendFull</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.run_configs</span> <span class="kn">import</span> <span class="n">Loihi1SimCfg</span><span class="p">,</span> <span class="n">Loihi2HwCfg</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.run_conditions</span> <span class="kn">import</span> <span class="n">RunSteps</span><span class="p">,</span> <span class="n">RunContinuous</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.connect.connect</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.operations.operations</span> <span class="kn">import</span> <span class="n">Weights</span><span class="p">,</span> <span class="n">Convolution</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.inputs.gauss_pattern.process</span> <span class="kn">import</span> <span class="n">GaussPattern</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.inputs.rate_code_spike_gen.process</span> <span class="kn">import</span> <span class="n">RateCodeSpikeGen</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.kernels.kernels</span> <span class="kn">import</span> <span class="n">Kernel</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.kernels.kernels</span> <span class="kn">import</span> <span class="n">MultiPeakKernel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.model</span> <span class="kn">import</span> <span class="n">PyLoihiProcessModel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.decorator</span> <span class="kn">import</span> <span class="n">implements</span><span class="p">,</span> <span class="n">requires</span><span class="p">,</span> <span class="n">tag</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.resources</span> <span class="kn">import</span> <span class="n">CPU</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.type</span> <span class="kn">import</span> <span class="n">LavaPyType</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.ports</span> <span class="kn">import</span> <span class="n">PyInPort</span><span class="p">,</span> <span class="n">PyOutPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.sync.protocols.loihi_protocol</span> <span class="kn">import</span> <span class="n">LoihiProtocol</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.process</span> <span class="kn">import</span> <span class="n">AbstractProcess</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.ports.ports</span> <span class="kn">import</span> <span class="n">InPort</span><span class="p">,</span> <span class="n">OutPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.variable</span> <span class="kn">import</span> <span class="n">Var</span>
<span class="kn">from</span> <span class="nn">lava.proc.dense.process</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.sub.model</span> <span class="kn">import</span> <span class="n">AbstractSubProcessModel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.decorator</span> <span class="kn">import</span> <span class="n">implements</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.ports.ports</span> <span class="kn">import</span> <span class="n">RefPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.ports</span> <span class="kn">import</span> <span class="n">PyRefPort</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.operations.operations</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Weights</span><span class="p">,</span>
    <span class="n">ExpandDims</span><span class="p">,</span>
    <span class="n">ReorderDims</span><span class="p">,</span>
    <span class="n">ReduceAlongDiagonal</span><span class="p">,</span>
    <span class="n">ExpandAlongDiagonal</span><span class="p">,</span>
    <span class="n">Flip</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">lava.utils.system</span> <span class="kn">import</span> <span class="n">Loihi2</span>
<span class="n">Loihi2</span><span class="o">.</span><span class="n">preferred_partition</span> <span class="o">=</span> <span class="s1">&#39;oheogulch&#39;</span>
<span class="n">loihi2_is_available</span> <span class="o">=</span> <span class="n">Loihi2</span><span class="o">.</span><span class="n">is_loihi2_available</span>

<span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running on </span><span class="si">{</span><span class="n">Loihi2</span><span class="o">.</span><span class="n">partition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">lava.proc.embedded_io.spike</span> <span class="kn">import</span> <span class="n">PyToNxAdapter</span><span class="p">,</span> <span class="n">NxToPyAdapter</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loihi2 compiler is not available in this system. &quot;</span>
          <span class="s2">&quot;This tutorial will execute on CPU backend.&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArchitectureDNF</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">kernel</span><span class="p">:</span> <span class="n">Kernel</span><span class="p">,</span><span class="n">time_steps</span><span class="p">,</span><span class="n">size_gauss</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">size_gauss</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span> <span class="o">=</span> <span class="n">size_gauss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">=</span> <span class="n">time_steps</span>
        <span class="c1"># Instantiate Processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">10.25</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span> <span class="o">=</span> <span class="n">RateCodeSpikeGen</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span> <span class="o">=</span> <span class="n">RateCodeSpikeGen</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span> <span class="o">+</span> <span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">340</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf1</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf2</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnftf</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="o">+</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        
        <span class="c1"># When running on Loihi 2 we additionally have spike injector and reader CProcesses. </span>
        <span class="c1"># They bridge Python and NC-Processes</span>
        <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injector1</span> <span class="o">=</span> <span class="n">PyToNxAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injector2</span> <span class="o">=</span> <span class="n">PyToNxAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spike_reader</span> <span class="o">=</span> <span class="n">NxToPyAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
        
        <span class="c1"># Make Connections of the Network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">injector1</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">injector2</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injector1</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injector2</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
        <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span> <span class="p">[</span><span class="n">Convolution</span><span class="p">(</span><span class="n">kernel</span><span class="p">)])</span>
        <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span> <span class="p">[</span><span class="n">Convolution</span><span class="p">(</span><span class="n">kernel</span><span class="p">)])</span>
        <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span><span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">ExpandDims</span><span class="p">(</span><span class="n">new_dims_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">Weights</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span><span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">ExpandDims</span><span class="p">(</span><span class="n">new_dims_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">ReorderDims</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span><span class="n">Weights</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
            
        <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_reader</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
            <span class="c1">#self.spike_reader.out.connect(self.py_receiver.a_in)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnftf</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>

        <span class="c1"># Set up a run configuration</span>
        <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span> <span class="o">=</span> <span class="n">Loihi2HwCfg</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span> <span class="o">=</span> <span class="n">Loihi1SimCfg</span><span class="p">(</span><span class="n">select_tag</span><span class="o">=</span><span class="s2">&quot;fixed_pt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">condition1</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        <span class="n">condition2</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">condition3</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1">#self.gauss_1.amplitude = 10000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition2</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition1</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
        <span class="c1">#self.gauss_position.run(condition=self.run_continuous, run_cfg=self.run_cfg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#self.gauss_1.amplitude = 3000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mf">20.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dnf1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dnf2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dnftf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnftf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="c1">#print(self.data_dnf1[0])</span>
        <span class="c1">#print(self.data_dnftf[0])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_gauss1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_gauss1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_gauss2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_gauss2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_grid</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Projection of Gauss 1 and 2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gauss 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gauss 2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_gauss</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_plot_gauss</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#self.ani.save(&#39;/home/altair/Postdoc/Codes/sim_dnf/simple_sim.mp4&#39;, writer = &#39;ffmpeg&#39;, fps = 30)</span>

    <span class="k">def</span> <span class="nf">setup_plot_gauss</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_gauss1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gauss1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_gauss2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gauss2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
        <span class="c1"># For FuncAnimation&#39;s sake, we need to return the artist we&#39;ll be using</span>
        <span class="c1"># Note that it expects a sequence of artists, thus the trailing comma.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">update_gauss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_gauss1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dnf1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_gauss2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dnf2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dnftf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gauss1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_gauss2</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span>

        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">detection_kernel</span> <span class="o">=</span> <span class="n">MultiPeakKernel</span><span class="p">(</span><span class="n">amp_exc</span><span class="o">=</span><span class="mi">83</span><span class="p">,</span> <span class="n">width_exc</span><span class="o">=</span><span class="mf">3.75</span><span class="p">,</span> <span class="n">amp_inh</span><span class="o">=-</span><span class="mi">70</span><span class="p">,</span> <span class="n">width_inh</span><span class="o">=</span><span class="mf">7.5</span><span class="p">)</span>
    <span class="n">architecture</span> <span class="o">=</span> <span class="n">ArchitectureDNF</span><span class="p">(</span><span class="n">detection_kernel</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    
    <span class="n">architecture</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">architecture</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        
</pre></div>
</div>
<p>At first, we import the necessary libraries :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span>
<span class="kn">from</span> <span class="nn">lava.proc.lif.process</span> <span class="kn">import</span> <span class="n">LIF</span> <span class="c1"># type: ignore</span>
<span class="kn">from</span> <span class="nn">lava.proc.monitor.process</span> <span class="kn">import</span> <span class="n">Monitor</span>
<span class="kn">from</span> <span class="nn">lava.proc.monitor.models</span> <span class="kn">import</span> <span class="n">PyMonitorModel</span>
<span class="kn">from</span> <span class="nn">lava.proc.dense.process</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.sink</span> <span class="kn">import</span> <span class="n">RingBuffer</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.extractor</span> <span class="kn">import</span> <span class="n">VarWire</span>
<span class="kn">from</span> <span class="nn">lava.proc.io.utils</span> <span class="kn">import</span> <span class="n">ChannelConfig</span><span class="p">,</span> <span class="n">SendFull</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.run_configs</span> <span class="kn">import</span> <span class="n">Loihi1SimCfg</span><span class="p">,</span> <span class="n">Loihi2HwCfg</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.run_conditions</span> <span class="kn">import</span> <span class="n">RunSteps</span><span class="p">,</span> <span class="n">RunContinuous</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.connect.connect</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.operations.operations</span> <span class="kn">import</span> <span class="n">Weights</span><span class="p">,</span> <span class="n">Convolution</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.inputs.gauss_pattern.process</span> <span class="kn">import</span> <span class="n">GaussPattern</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.inputs.rate_code_spike_gen.process</span> <span class="kn">import</span> <span class="n">RateCodeSpikeGen</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.kernels.kernels</span> <span class="kn">import</span> <span class="n">Kernel</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.kernels.kernels</span> <span class="kn">import</span> <span class="n">MultiPeakKernel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.model</span> <span class="kn">import</span> <span class="n">PyLoihiProcessModel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.decorator</span> <span class="kn">import</span> <span class="n">implements</span><span class="p">,</span> <span class="n">requires</span><span class="p">,</span> <span class="n">tag</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.resources</span> <span class="kn">import</span> <span class="n">CPU</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.type</span> <span class="kn">import</span> <span class="n">LavaPyType</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.ports</span> <span class="kn">import</span> <span class="n">PyInPort</span><span class="p">,</span> <span class="n">PyOutPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.sync.protocols.loihi_protocol</span> <span class="kn">import</span> <span class="n">LoihiProtocol</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.process</span> <span class="kn">import</span> <span class="n">AbstractProcess</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.ports.ports</span> <span class="kn">import</span> <span class="n">InPort</span><span class="p">,</span> <span class="n">OutPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.variable</span> <span class="kn">import</span> <span class="n">Var</span>
<span class="kn">from</span> <span class="nn">lava.proc.dense.process</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.sub.model</span> <span class="kn">import</span> <span class="n">AbstractSubProcessModel</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.decorator</span> <span class="kn">import</span> <span class="n">implements</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.process.ports.ports</span> <span class="kn">import</span> <span class="n">RefPort</span>
<span class="kn">from</span> <span class="nn">lava.magma.core.model.py.ports</span> <span class="kn">import</span> <span class="n">PyRefPort</span>
<span class="kn">from</span> <span class="nn">lava.lib.dnf.operations.operations</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Weights</span><span class="p">,</span>
    <span class="n">ExpandDims</span><span class="p">,</span>
    <span class="n">ReorderDims</span><span class="p">,</span>
    <span class="n">ReduceAlongDiagonal</span><span class="p">,</span>
    <span class="n">ExpandAlongDiagonal</span><span class="p">,</span>
    <span class="n">Flip</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">lava.utils.system</span> <span class="kn">import</span> <span class="n">Loihi2</span>
<span class="n">Loihi2</span><span class="o">.</span><span class="n">preferred_partition</span> <span class="o">=</span> <span class="s1">&#39;oheogulch&#39;</span>
<span class="n">loihi2_is_available</span> <span class="o">=</span> <span class="n">Loihi2</span><span class="o">.</span><span class="n">is_loihi2_available</span>

<span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running on </span><span class="si">{</span><span class="n">Loihi2</span><span class="o">.</span><span class="n">partition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">lava.proc.embedded_io.spike</span> <span class="kn">import</span> <span class="n">PyToNxAdapter</span><span class="p">,</span> <span class="n">NxToPyAdapter</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loihi2 compiler is not available in this system. &quot;</span>
          <span class="s2">&quot;This tutorial will execute on CPU backend.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>At the end, the condition determines if the code is running on Loihi 2 or on CPU. It will adapt the simulation accordingly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArchitectureDNF</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">kernel</span><span class="p">:</span> <span class="n">Kernel</span><span class="p">,</span><span class="n">time_steps</span><span class="p">,</span><span class="n">size_gauss</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">size_gauss</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_shape</span> <span class="o">=</span> <span class="n">size_gauss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">=</span> <span class="n">time_steps</span>
        <span class="c1"># Instantiate Processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">10.25</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The use of a class structure is not required, however it facilitates the maintenance of the code. The parameters of the class are the kernel used by the DNF that we will define in the main function. The second param defines for how long the simulation will run and the third param indicates the size of the 1D fields. Then, we create 2 gaussian patterns that will serve as inputs to the neural fields.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span> <span class="o">=</span> <span class="n">RateCodeSpikeGen</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span> <span class="o">=</span> <span class="n">RateCodeSpikeGen</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">input_dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">LIF</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span> <span class="o">+</span> <span class="n">shape</span><span class="p">,</span> <span class="n">du</span><span class="o">=</span><span class="mi">409</span><span class="p">,</span> <span class="n">dv</span><span class="o">=</span><span class="mi">2045</span><span class="p">,</span> <span class="n">vth</span><span class="o">=</span><span class="mi">340</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf1</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf2</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnftf</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="o">+</span><span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
</pre></div>
</div>
<p>First we define spike generator that will transform the gaussian patterns into rate coded spikes. The input dense are fully connected weights. Then, we declare 3 spiking neural networks as LIF models. The dnf1 and dnf2 will be one dimensional and the transformation LIF will receive projections from dnf1 and dnf2. Finally, we declare 3 RingBuffer that will be in charge to listen to all the fields at every time steps. This will help us later to display the results of the simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="c1"># When running on Loihi 2 we additionally have spike injector and reader CProcesses. </span>
      <span class="c1"># They bridge Python and NC-Processes</span>
      <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">injector1</span> <span class="o">=</span> <span class="n">PyToNxAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">injector2</span> <span class="o">=</span> <span class="n">PyToNxAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">spike_reader</span> <span class="o">=</span> <span class="n">NxToPyAdapter</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># type: ignore</span>
      
      <span class="c1"># Make Connections of the Network</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">injector1</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">injector2</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">injector1</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">injector2</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">spike_generator_2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">s_in</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we begin to connect the elements together according to the platform where the simulation is running. If runing on Loihi, we need to use the injectors (PyToNxAdapter). We then connect the gaussian inputs to the spike generators and finally connect the spike generators to the fully connected weights.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="bp">self</span><span class="o">.</span><span class="n">input_dense1</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">input_dense2</span><span class="o">.</span><span class="n">a_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span> <span class="p">[</span><span class="n">Convolution</span><span class="p">(</span><span class="n">kernel</span><span class="p">)])</span>
      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span> <span class="p">[</span><span class="n">Convolution</span><span class="p">(</span><span class="n">kernel</span><span class="p">)])</span>
      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span><span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">ExpandDims</span><span class="p">(</span><span class="n">new_dims_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">Weights</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span><span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">ExpandDims</span><span class="p">(</span><span class="n">new_dims_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">ReorderDims</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span><span class="n">Weights</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
         
      <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spike_reader</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
         <span class="c1">#self.spike_reader.out.connect(self.py_receiver.a_in)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">dnf1</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf1</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnf2</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">s_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py_receiver_dnftf</span><span class="o">.</span><span class="n">a_in</span><span class="p">)</span>

      <span class="c1"># Set up a run configuration</span>
      <span class="k">if</span> <span class="n">loihi2_is_available</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span> <span class="o">=</span> <span class="n">Loihi2HwCfg</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span> <span class="o">=</span> <span class="n">Loihi1SimCfg</span><span class="p">(</span><span class="n">select_tag</span><span class="o">=</span><span class="s2">&quot;fixed_pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We continue to connect the components togethers by linking the two dense weights to the LIF networks. Then, we properly define dnf1 and dnf2 as dynamic neural fields by applying a convolution with the kernel. In practice, this means that we apply a set of recurrent weights on the LIF network with the gaussian shape of the kernel. A classic gaussian kernel will define excitatory connection at a peak location. In case of a mexican hat gaussian kernel, this will apply a local excitation with a surround inhibition.
Then, we project dnf1 horizontally and dnf2 vertically to the projection LIF.
Finally, we connect the fields to the data listeners and we setup a configuration for the simulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">condition1</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition1</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition1</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>This function first define the condition that has to be passed on the gaussian inputs. We then run the dnf1 and dnf2. There is no need to run the projection LIF since it is connected at the end of the other fields.
The rest of the code is dedicated to the display of datas. You can simply run the code :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">sim_dnf</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="test" src="https://github.com/rouzinho/Neuromorphic-Computing/blob/main/img/simple_sim.gif?raw=true" /></p>
<p>It is possible to change the values of the gaussian pattern during runtime :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">condition1</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
      <span class="n">condition2</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
      <span class="n">condition3</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition2</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition1</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mf">20.0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">5000</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="test" src="https://github.com/rouzinho/Neuromorphic-Computing/blob/main/img/sim_change.gif?raw=true" /></p>
</section>
<section id="working-memory">
<h2>Working memory<a class="headerlink" href="#working-memory" title="Link to this heading"></a></h2>
<p>An interesting property of dynamic neural fields is to be able to generate neural dynamics that produces a working memory. This means that spikes can continue to occurs even in the absence of inputs. To do so, we need to add a kernel to the transformation LIF so it can turn into a neural field :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dnf2</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span><span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">ExpandDims</span><span class="p">(</span><span class="n">new_dims_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">ReorderDims</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span><span class="n">Weights</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
      <span class="n">kernel_wm</span> <span class="o">=</span> <span class="n">MultiPeakKernel</span><span class="p">(</span><span class="n">amp_exc</span><span class="o">=</span><span class="mi">58</span><span class="p">,</span>
                         <span class="n">width_exc</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                         <span class="n">amp_inh</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span>
                         <span class="n">width_inh</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
      <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">s_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">a_in</span><span class="p">,</span> <span class="p">[</span><span class="n">Convolution</span><span class="p">(</span><span class="n">kernel_wm</span><span class="p">)])</span>
</pre></div>
</div>
<p>You can also change the gaussian amplitude of the inputs to 0 to begin with :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>         <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">10.25</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span> <span class="o">=</span> <span class="n">GaussPattern</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                            <span class="n">amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                            <span class="n">mean</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                                            <span class="n">stddev</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Then use this protocol in run() :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="n">condition1</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
      <span class="n">condition2</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
      <span class="n">condition3</span> <span class="o">=</span> <span class="n">RunSteps</span><span class="p">(</span><span class="n">num_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
      
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">7000</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">7000</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition2</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition2</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gauss_2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="n">condition3</span><span class="p">,</span> <span class="n">run_cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>And you can setup the general number of steps to 250 in main():</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">architecture</span> <span class="o">=</span> <span class="n">ArchitectureDNF</span><span class="p">(</span><span class="n">detection_kernel</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>This start the simulation with no inputs, then excitation for 50 steps and finally no inputs again. As you can see, the spikes are continuing even after the inputs disapeared.</p>
<p><img alt="test" src="https://github.com/rouzinho/Neuromorphic-Computing/blob/main/img/wm.gif?raw=true" /></p>
<p>The source code is available in the sim_dnf folder <a class="reference external" href="https://github.com/rouzinho/Neuromorphic-Computing/tree/main/src">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Loihi2.html" class="btn btn-neutral float-left" title="Intel Neuromorphic Chip" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ros_interface.html" class="btn btn-neutral float-right" title="ROS interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright workshop participant.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>